<!DOCTYPE html>
<html>
  <head>
    <title>Ontobrowse</title>
    
    <!-- Include order: first jquery, then opencpu.js, and then your code -->
    <script src="opencpu/jquery-1.10.2.min.js"></script>
    <script src="opencpu/opencpu-0.4.js"></script>
    <link rel="stylesheet" href="dist/themes/default/style.min.css" />
    <script>
    //init this script when the page has loaded
    $(document).ready(function(){

        //perform the request
        $('#jstree').jstree({
          'core' : {
            'data' : function (node, cb) {
                //console.log(node["id"])
                if(node["id"] == "#"){
                  var id = '9000';
                }
                else{
                  var id = node["id"];
                }
                jQuery.ajax({
                    type: 'POST',
                    url: "../R/ontobrowse",
                    data: { 'term' : id,
                            "lang": "\"la\"",
                            "origin": '9000'
                          },
                    success: function(dat) {
                        n = dat.split("\n");
                        n = n[0] + "/json";
                        jQuery.ajax({
                            type: 'GET',
                            url: n,
                            success: function(data){
                             n = data.message
                             //console.log(n["children"])
                             kids = [];
                             for(i in n["children"]){
                                kids.push(
                                  { "id" : n["children"][i][0],
                                    "text" : n["children"][i][1],
                                    "state" : {'opened': false},
                                    "children" : true
                                  }
                                  );
                             }
                             //console.log(kids)
                          
                             tree= {
                                'id' : n["id"],
                                'text' : n["name"],
                                'state' : { 'opened' : true, 'selected' : true },
                                'children' : kids
                              }
                              cb(tree);
                            }
                        })
                    }
                })
          }
        }
          });
        
        //if R returns an error, alert the error message
        //req.fail(function(){
        //  alert("Server error: " + req.responseText);
       // });

    });
    
    </script>
    <style>
      #output{
        height: 400px;
        width: 500px;
        border: 1px solid gray;
        padding: 3px;
      }
    </style>
    
  </head>
    
  <body>
    <h1>Browse your ontology!</h1>
    
    <input id="input" type="hidden">

    <div id="jstree"></div>
    <!-- in this example the tree is populated from inline HTML --> 
    <!--
    <ul>
      <li>Root node 1
        <ul>
          <li id="child_node_1">Child node 1</li>
          <li>Child node 2</li>
        </ul>
      </li>
      <li>Root node 2</li>
    </ul>
  -->
  
    <br />
   <script src="dist/jstree.min.js"></script> 
  
  </body>
</html>