<!DOCTYPE html>
<html>
  <head>
    <title>Ontobrowse</title>
    
    <!-- Include order: first jquery, then opencpu.js, and then your code -->
    <script src="opencpu/jquery-1.10.2.min.js"></script>
    <script src="opencpu/opencpu-0.4.js"></script>
    <script src="dist/jstree.min.js"></script> 
    <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <link rel="stylesheet" href="dist/themes/proton/style.min.css" />
    

    <script>

      //$(function() {
      //  $( "#menu" ).menu();
      //});

    //init this script when the page has loaded
    $(document).ready(function(){
      //function tree(term_id, lang){
        //perform the request
        $('#jstree').jstree({
          'plugins': ["checkbox"],
          'core' : {
            'themes': {
                'name': 'proton',
                'responsive': true
            },
            'data' : function (node, cb) {
                //console.log(node["id"])
                if(node["id"] == "#"){
                  var id = '9000';
                }
                else{
                  var id = node["id"];
                }
                jQuery.ajax({
                    type: 'POST',
                    url: "../R/ontobrowse",
                    data: { 'term' : id,
                            "lang": "\"la\"",
                            "origin": '9000'
                          },
                    success: function(dat) {
                        n = dat.split("\n");
                        n = n[0] + "/json";
                        jQuery.ajax({
                            type: 'GET',
                            url: n,
                            success: function(data){
                             n = data.message
                             //console.log(n["children"])
                             kids = [];
                             for(i in n["children"]){       
                                //console.log(n["children"][i][2]);
                                if(n["children"][i][2] == "TRUE"){
                                  var haskids = true;
                                }
                                else{
                                  var haskids = false;
                                }
                                //console.log(haskids);
                                kids.push(
                                  { "id" : n["children"][i][0],
                                    "text" : n["children"][i][1],
                                    "state" : {'opened': false},
                                    "children" : haskids
                                  }
                                  );
                             }
                             //console.log(kids)
                          
                             tree= {
                                'id' : n["id"],
                                'text' : n["name"],
                                'state' : { 'opened' : true},
                                'children' : kids
                              }
                              cb(tree);
                            }
                        })
                    }
                })
          }
        }
          });
        
                //if R returns an error, alert the error message
                //req.fail(function(){
                //  alert("Server error: " + req.responseText);
               // });
   //   }
    });
    
    </script>
    
    <style>
      .ui-menu { width: 150px; }
    </style>
  
  </head>
    
  <body>

    <h1>Browse your ontology!</h1>

        <!--
    <ul id="menu">
  <li class="ui-state-disabled">Aberdeen</li>
  <li>Ada</li>
  <li>Adamsville</li>
  <li>Addyston</li>
  <li>Delphi
    <ul>
      <li class="ui-state-disabled">Ada</li>
      <li>Saarland</li>
      <li>Salzburg an der sch√∂nen Donau</li>
    </ul>
  </li>
  <li>Saarland</li>
  <li>Salzburg
    <ul>
      <li>Delphi
        <ul>
          <li>Ada</li>
          <li>Saarland</li>
          <li>Salzburg</li>
        </ul>
      </li>
      <li>Delphi
        <ul>
          <li>Ada</li>
          <li>Saarland</li>
          <li>Salzburg</li>
        </ul>
      </li>
      <li>Perch</li>
    </ul>
  </li>
  <li class="ui-state-disabled">Amesville</li>
</ul>
-->
    <div id="jstree"></div>
   
  
    <br />
  </body>
</html>